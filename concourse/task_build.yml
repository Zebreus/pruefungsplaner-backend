---
platform: linux

image_resource:
  type: registry-image
  source:
    repository: madmanfred/qt5-builder
    tag: latest

inputs:
  - name: pruefungsplaner-backend
    path: pruefungsplaner-backend
    optional: false

outputs:
  - name: built-backend

params:
  optimization_level: 3
  make_threads: 4

run:
  path: "/bin/bash"
  args:
   - -c
   - |
     qmake pruefungsplaner-backend.pro QMAKE_CXXFLAGS_RELEASE="'"-O${optimization_level}"'" QMAKE_LFLAGS_RELEASE="'"-O${optimization_level}"'" DESTDIR=../built-backend
     make -j ${make_threads}
  dir: ./pruefungsplaner-backend
